{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "5e02ac63",
   "metadata": {
    "papermill": {
     "duration": 0.001879,
     "end_time": "2025-11-13T08:57:48.068202",
     "exception": false,
     "start_time": "2025-11-13T08:57:48.066323",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "<div style=\"\n",
    "    background-color:#1e1e1e;\n",
    "    color:#f5f5f5;\n",
    "    padding:35px;\n",
    "    border-radius:12px;\n",
    "    font-family:'Segoe UI', 'Helvetica Neue', sans-serif;\n",
    "    line-height:1.7;\n",
    "    font-size:15px;\n",
    "\">\n",
    "\n",
    "<h1 style=\"text-align:center; color:#ffc107;\">üß© Understanding Perplexity in Language Models</h1>\n",
    "\n",
    "<p>\n",
    "<b>Perplexity (PP)</b> quantifies how confidently a language model predicts the next token.  \n",
    "It‚Äôs essentially the model‚Äôs <i>‚Äúdegree of surprise.‚Äù</i>  \n",
    "A low perplexity means smooth, natural predictions ‚Äî a high one means confusion or uncertainty.\n",
    "</p>\n",
    "\n",
    "<hr style=\"border:0.5px solid #444;\">\n",
    "\n",
    "<h2 style=\"color:#ffb74d;\">üìò Mathematical Definition</h2>\n",
    "\n",
    "<p style=\"text-align:center;\">\n",
    "PP = exp(H) = exp( ‚àí (1/N) Œ£ log P(w<sub>i</sub> | w<sub>1</sub>, ..., w<sub>i‚àí1</sub>) )\n",
    "</p>\n",
    "\n",
    "<ul>\n",
    "  <li><b>P(w<sub>i</sub> | w<sub>1</sub>, ..., w<sub>i‚àí1</sub>)</b>: Probability of the next token.</li>\n",
    "  <li><b>N</b>: Number of words in the sequence.</li>\n",
    "  <li><b>log‚ÄØP</b>: Log-likelihood, later exponentiated to get back to normal scale.</li>\n",
    "</ul>\n",
    "\n",
    "<p><i>Lower PP ‚Üí more predictable and fluent text.<br>Higher PP ‚Üí randomness or topic drift.</i></p>\n",
    "\n",
    "<hr style=\"border:0.5px solid #444;\">\n",
    "\n",
    "<h2 style=\"color:#ffb74d;\">üìä Numerical Interpretation</h2>\n",
    "\n",
    "<table style=\"width:100%; border-collapse:collapse; margin-top:8px;\">\n",
    "<thead>\n",
    "<tr style=\"background-color:#2a2a2a; color:#ffd54f;\">\n",
    "  <th style=\"padding:8px; border-bottom:1px solid #444;\">Perplexity Range</th>\n",
    "  <th style=\"padding:8px; border-bottom:1px solid #444;\">Meaning</th>\n",
    "</tr>\n",
    "</thead>\n",
    "<tbody>\n",
    "<tr>\n",
    "  <td style=\"padding:8px; border-bottom:1px solid #333;\">10 ‚Äì 25</td>\n",
    "  <td style=\"padding:8px; border-bottom:1px solid #333;\">Excellent ‚Äî coherent and human‚Äëlike fluency.</td>\n",
    "</tr>\n",
    "<tr>\n",
    "  <td style=\"padding:8px; border-bottom:1px solid #333;\">30 ‚Äì 70</td>\n",
    "  <td style=\"padding:8px; border-bottom:1px solid #333;\">Moderate ‚Äî the model struggles slightly with context.</td>\n",
    "</tr>\n",
    "<tr>\n",
    "  <td style=\"padding:8px; border-bottom:1px solid #333;\">&gt; 100</td>\n",
    "  <td style=\"padding:8px; border-bottom:1px solid #333;\">Poor ‚Äî the model is confused or off‚Äëdomain.</td>\n",
    "</tr>\n",
    "</tbody>\n",
    "</table>\n",
    "\n",
    "<hr style=\"border:0.5px solid #444;\">\n",
    "\n",
    "<h2 style=\"color:#ffb74d;\">‚öôÔ∏è Use Cases in NLP</h2>\n",
    "\n",
    "<ol>\n",
    "<li><b>Model Evaluation:</b> Compare language models ‚Äî the lower the PP, the better.</li>\n",
    "<li><b>AI vs Human Detection:</b> AI text = low & stable PP. Human text = high & variable PP.</li>\n",
    "<li><b>Dataset Filtering:</b> Identify unnatural or corrupted samples during preprocessing.</li>\n",
    "</ol>\n",
    "\n",
    "<hr style=\"border:0.5px solid #444;\">\n",
    "\n",
    "<h2 style=\"color:#ffb74d;\">üß† Intuitive Example</h2>\n",
    "\n",
    "<p>If a model predicts the next word in <code style=\"background-color:#2f2f2f; color:#fff;\">I love ___</code>:</p>\n",
    "\n",
    "<ul>\n",
    "<li><b>‚Äúyou‚Äù</b> with probability 0.9 ‚Üí low PP (expected, fluent).</li>\n",
    "<li><b>‚Äúbananas‚Äù</b> with probability 0.01 ‚Üí high PP (unexpected, off‚Äëcontext).</li>\n",
    "</ul>\n",
    "\n",
    "<hr style=\"border:0.5px solid #444;\">\n",
    "\n",
    "<h2 style=\"color:#ffb74d;\">üêç Example in Python (Kaggle‚ÄëReady)</h2>\n",
    "\n",
    "<pre style=\"background-color:#2b2b2b; color:#e0e0e0; padding:14px; border-radius:8px; overflow-x:auto;\">\n",
    "<code class=\"language-python\">\n",
    "from transformers import GPT2LMHeadModel, GPT2TokenizerFast\n",
    "import torch, math\n",
    "\n",
    "# Load GPT-2\n",
    "model_name = \"gpt2\"\n",
    "tokenizer = GPT2TokenizerFast.from_pretrained(model_name)\n",
    "model = GPT2LMHeadModel.from_pretrained(model_name)\n",
    "\n",
    "# Example text\n",
    "text = \"I love you so much.\"\n",
    "\n",
    "# Encode & evaluate\n",
    "inputs = tokenizer(text, return_tensors=\"pt\")\n",
    "with torch.no_grad():\n",
    "    loss = model(**inputs, labels=inputs[\"input_ids\"]).loss\n",
    "perplexity = math.exp(loss)\n",
    "\n",
    "print(f\"Perplexity: {perplexity:.2f}\")\n",
    "</code>\n",
    "</pre>\n",
    "\n",
    "<hr style=\"border:0.5px solid #444;\">\n",
    "\n",
    "<h2 style=\"color:#ffb74d;\">üß© Summary</h2>\n",
    "\n",
    "<ul>\n",
    "<li><b>Definition:</b> Statistical indicator of prediction confidence.</li>\n",
    "<li><b>Goal:</b> Lower perplexity = stronger model quality.</li>\n",
    "<li><b>AI Detection Insight:</b> Human writing ‚Üí variable PP; AI ‚Üí smooth & uniform PP.</li>\n",
    "</ul>\n",
    "\n",
    "\n",
    "\n",
    "</div>\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d910cffe",
   "metadata": {
    "papermill": {
     "duration": 0.001227,
     "end_time": "2025-11-13T08:57:48.070794",
     "exception": false,
     "start_time": "2025-11-13T08:57:48.069567",
     "status": "completed"
    },
    "tags": []
   },
   "source": []
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "none",
   "dataSources": [
    {
     "datasetId": 4005256,
     "sourceId": 6977472,
     "sourceType": "datasetVersion"
    }
   ],
   "dockerImageVersionId": 31192,
   "isGpuEnabled": false,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.13"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 5.165954,
   "end_time": "2025-11-13T08:57:48.390790",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-11-13T08:57:43.224836",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
